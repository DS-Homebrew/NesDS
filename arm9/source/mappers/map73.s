@---------------------------------------------------------------------------------
	#include "equates.h"
	#include "6502mac.h"
@---------------------------------------------------------------------------------
	.global mapper73init
	counter = mapperData
	irqen = mapperData+4
@---------------------------------------------------------------------------------
.section .text,"ax"
@---------------------------------------------------------------------------------
mapper73init:	@Konami Salamander (J)...
@---------------------------------------------------------------------------------
	.word write8000,writeA000,writeC000,writeE000

	adr r0,hook
	str_ r0,scanlineHook

	bx lr
@---------------------------------------------------------------------------------
write8000:
@---------------------------------------------------------------------------------
	ldr_ r2,counter
	and r0,r0,#0xF
	tst addy,#0x1000
	bne write9000
	bic r2,r2,#0xF0000
	orr r0,r2,r0,lsl#16
	str_ r0,counter
	bx lr
write9000:
	bic r2,r2,#0xF00000
	orr r0,r2,r0,lsl#20
	str_ r0,counter
	bx lr
@---------------------------------------------------------------------------------
writeA000:
@---------------------------------------------------------------------------------
	ldr_ r2,counter
	and r0,r0,#0xF
	tst addy,#0x1000
	bne writeB000
	bic r2,r2,#0xF000000
	orr r0,r2,r0,lsl#24
	str_ r0,counter
	bx lr
writeB000:
	bic r2,r2,#0xF0000000
	orr r0,r2,r0,lsl#28
	str_ r0,counter
	bx lr
@---------------------------------------------------------------------------------
writeC000:
@---------------------------------------------------------------------------------
	tst addy,#0x1000
	andeq r0,r0,#2
	streqb_ r0,irqen
	bx lr
@---------------------------------------------------------------------------------
writeE000:
@---------------------------------------------------------------------------------
	tst addy,#0x1000
	bne map89AB_
	bx lr
@---------------------------------------------------------------------------------
hook:
@---------------------------------------------------------------------------------
	ldrb_ r0,irqen
	cmp r0,#0	@timer active?
	beq h1

	ldr_ r0,counter
@	adds r0,r0,#0x71aaab		;113.66667
	adds r0,r0,#0x720000
	bcc h0
	mov r0,#0
	strb_ r0,irqen
	sub r0,r0,#0x10000
	str_ r0,counter
@	b irq6502
	b CheckI
h0:
	str_ r0,counter
h1:
	fetch 0
@---------------------------------------------------------------------------------
