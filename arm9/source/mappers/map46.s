;@----------------------------------------------------------------------------
	#include "equates.h"
;@----------------------------------------------------------------------------
	.global mapper46init

	.struct mapperData
prgReg:	.byte 0
chrReg:	.byte 0
		.skip 2
;@----------------------------------------------------------------------------
.section .text,"ax"
;@----------------------------------------------------------------------------
;@ Color Dreams Multicart
mapper46init:
;@----------------------------------------------------------------------------
	.word write46,write46,write46,write46
	adr r0,writeOuter
	str_ r0,m6502WriteTbl+12
	mov r0,#0
	b w46
;@----------------------------------------------------------------------------
writeOuter:				;@ [CCCC PPPP]
;@----------------------------------------------------------------------------
	ldr_ r1,prgReg
	mov r0,r0,ror#4
	bic r1,r1,#0xF800
	orr r1,r1,r0,lsl#11

	bic r1,r1,#0x00FE
	orr r0,r1,r0,lsr#27
	b w46
;@----------------------------------------------------------------------------
write46:				;@ [.ccc ...p]
;@----------------------------------------------------------------------------
	ldr_ r1,prgReg
	and r2,r0,#0x70
	bic r1,r1,#0x0700
	orr r1,r1,r2,lsl#4

	and r0,r0,#1
	bic r1,r1,#0x0001
	orr r0,r1,r0
w46:
	str_ r0,prgReg
	stmfd sp!,{r0,lr}
	bl map89ABCDEF_
	ldmfd sp!,{r0,lr}
	mov r0,r0,lsr#8
	b chr01234567_

;@----------------------------------------------------------------------------
